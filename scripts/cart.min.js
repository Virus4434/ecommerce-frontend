document.addEventListener('DOMContentLoaded', () => {
  displayCartItems();
});

function displayCartItems() {
  const cartItemsContainer = document.getElementById('cartItems');
  const cartTotalElement = document.getElementById('cartTotal');
  const checkoutBtn = document.getElementById('checkoutBtn');

  if (!cartItemsContainer || !cartTotalElement || !checkoutBtn) {
      console.error('Required DOM elements not found');
      return;
  }

  let cart = JSON.parse(localStorage.getItem('cart'));
  if (!cart) {
      cart = [];
      localStorage.setItem('cart', JSON.stringify(cart));
  }

  if (cart.length === 0) {
      cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
      checkoutBtn.disabled = true;
      cartTotalElement.textContent = '0.00';
      return;
  }

  cartItemsContainer.innerHTML = cart.map(item => `
      <div class="cart-item">
          <img src="${item.image || './assets/default-image.png'}" alt="${item.title}" class="cart-item-image">
          <div class="cart-item-details">
              <h3>${item.title || 'Unnamed Product'}</h3>
              <p>Price: $${(item.price || 0).toFixed(2)}</p>
              <p>Size: ${item.size || 'N/A'}</p>
              <div class="quantity-selector">
                  <button class="qty-btn" onclick="adjustQuantity(${item.id}, -1)">âˆ’</button>
                  <input type="number" id="quantity-${item.id}" value="${item.quantity || 1}" min="1" readonly>
                  <button class="qty-btn" onclick="adjustQuantity(${item.id}, 1)">+</button>
              </div>
              <button class="remove-btn" onclick="removeItem(${item.id})">Remove</button>
          </div>
      </div>
  `).join('');

  updateTotalPrice();
  checkoutBtn.disabled = false;
}

function adjustQuantity(productId, change) {
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  const itemIndex = cart.findIndex(item => item.id === productId);

  if (itemIndex !== -1) {
      cart[itemIndex].quantity = Math.max(1, (cart[itemIndex].quantity || 1) + change);
      document.getElementById(`quantity-${productId}`).value = cart[itemIndex].quantity;
      localStorage.setItem('cart', JSON.stringify(cart));
      updateTotalPrice();
      displayCartItems(); // Refresh display
  }
}

function removeItem(productId) {
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart = cart.filter(item => item.id !== productId);
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
  displayCartItems();
}

function updateTotalPrice() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  const cartTotalElement = document.getElementById('cartTotal');
  if (!cartTotalElement) return;

  const total = cart.reduce((sum, item) => sum + ((item.price || 0) * (item.quantity || 1)), 0);
  cartTotalElement.textContent = total.toFixed(2);
  updateCartCount();
}

function updateCartCount() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  const cartBadge = document.querySelector('.notification-badge');
  if (cartBadge) {
      cartBadge.textContent = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
  }
  localStorage.setItem('cart', JSON.stringify(cart));
}

// Redirect to checkout page (placeholder, replace with actual checkout URL)
document.getElementById('checkoutBtn')?.addEventListener('click', () => {
  window.location.href = 'checkout.html'; // Replace with actual checkout page
});